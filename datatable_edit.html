<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>DataTables Edit Bootstrap 3</title>
<!-- <style>
.btn-danger-text {
	color: #bd362f;
}

.btn-danger-text:hover, .btn-danger-text:active, .btn-danger-text.active,
	.btn-danger-text.disabled, .btn-danger-text[disabled] {
	color: #bd362f;
	*color: #a9302a;
}

.btn-danger-text:active, .btn-danger-text.active {
	color: #942a25 \9;
}
</style> -->
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/dataTables.bootstrap.css">

<style>
.modal {
	top: 15%;
}
</style>

<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="js/dataTables.bootstrap.js"></script>
<script type="text/javascript" src="js/jquery.validate.min.js"></script>

<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
		
		$('#datatable').dataTable( {
			serverSide: true,
		    ajax: 'paging.php',
		    "ordering": false,
		    "lengthChange": false,
	        "scrollY": "400px",
	        "scrollCollapse": false,
		    language: {
		        search: "Ricerca:",
		        paginate: {
		            first:      "Primo",
		            previous:   "<<",
		            next:       ">>",
		            last:       "Ultimo"
		        },
		    },
		    "drawCallback": function( settings ) {
		    	$('#datatable tbody tr').on('click', function(event) {
				    $(this).toggleClass('active').siblings().removeClass('active');
				});
		    }
		} );	
		
		$.validator.setDefaults({
			errorElement: "span",
		    errorClass: "has-error help-block",
		    highlight: function (element, errorClass, validClass) {
		        $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
		    },
		    unhighlight: function (element, errorClass, validClass) {
		    	$(element).closest('.form-group').removeClass('has-error');
		    },
		    errorPlacement: function (error, element) {
	 	       error.insertAfter(element.parent());
		    }
		});
		
		$.validator.messages={
			required : 'Campo obbligatorio',
			number: "Necessario valore numerico"
		};
		
		var validator = $('#form-edit').validate({
		    rules: {
		    	tipologia: "required",
		    	insegna: "required",
		    	indirizzo: "required",
		    	camere: {
		    		required:true,
		    		number: true
		    	},
		    	posti: {
		    		required:true,
		    		number: true
		    	}   	
		 	}
		});
		
		// TOOLBAR
		
		$('#btn-new').on('click', function(event) {
			$('#dialog-new').modal('show');
		});
		
		$('#btn-edit').on('click', function(event) {
			var id = $('#datatable tbody tr.active').children('td:eq(0)').text(); 
			if(id){
				$('#dialog-edit').modal('show');
				$.ajax({
				      type: "GET",
				      url: "api/model/load",
				      dataType: "json",
				      data: {"id":id},
				      success: function (data) {
				        console.debug(JSON.stringify(data));
				        var $inputs = $('#form-edit  input');
				        $.each(data, function(key, value) {
				          $inputs.filter(function() {
				            return key == this.name;
				          }).val(value);
				        });
				      },
				      error: function (xhr, ajaxOptions, thrownError) {
				        alert(xhr.status);
				        alert(thrownError);
				      }
				});
				//$("#id").val(id);
				$("#id").attr('readonly', true);
			}
		});
		
		$('#btn-delete').on('click', function(event) {
			var id = $('#datatable tbody tr.active').children('td:eq(0)').text();
			if(id){
				$('#dialog-delete').modal('show');
			}
			
		});
		
		$("#dialog-edit").on('show.bs.modal', function (e) {
			$('#form-edit')[0].reset();
			validator.resetForm();
			$(".has-error").removeClass("has-error");
		})
		
// 		$("#dialog-edit").on('hide.bs.modal', function (e) {
// 			$('#form-edit')[0].reset();
// 			validator.resetForm();
// 			$(".has-error").removeClass("has-error");
// 		});
		
		$('#btn-reset').on('click', function(event) {
			// reset form, validator, remove error class
			$('#form-edit')[0].reset();
			validator.resetForm();
			$(".has-error").removeClass("has-error");
		});
		
	} );
</script>
</head>
<body>
	<br />
	<div class="container">
		<br />
		<div class="row" style="position: absolute;">
			<button type="button" id="btn-new" class="btn btn-primary">New</button>
			<button type="button" id="btn-edit" class="btn btn-success">Edit</button>
			<button type="button" id="btn-delete" class="btn btn-danger">Delete</button>
		</div>
		<div class="row">
			<table class="table table-hover table-striped table-bordered" id="datatable">
				<thead>
					<tr>
						<th class="col-md-1">Id</th>
						<th class="col-md-1">Tipologia</th>
						<th class="col-md-4">Insegna</th>
						<th class="col-md-3">Indirizzo</th>
						<th class="col-md-1">Categoria</th>
						<th class="col-md-1">Camere</th>
						<th class="col-md-1">Posti</th>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
		</div>
	</div>

	<div class="modal" id="dialog-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h3 class="modal-title"><span class="label label-danger">Attenzione</span></h3>
				</div>
				<div class="modal-body">L'operazione canceller√† l'elemento selezionato</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					<a href="#" class="btn btn-danger danger">Delete</a>
				</div>
			</div>
		</div>
	</div>
	

	
	
	<div class="modal" id="dialog-edit" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h3 class="modal-title"><span class="label label-success">Modifica</span></h3>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" id="form-edit">
						<div class="form-group">
							<label class="col-sm-4 control-label" for="id">Id</label>
							<div class="col-md-2">
								<input name="id" id="id" type=text class="form-control uneditable-input">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="tipologia">Tipologia</label>
							<div class="col-md-4">
								<input name="tipologia" id="tipologia" type=text class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="insegna">Insegna</label>
							<div class="col-md-4">
								<input name="insegna" id="insegna" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="indirizzo">Indirizzo</label>
							<div class="col-md-4">
								<input name="indirizzo" id="indirizzo" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="categoria">Categoria</label>
							<div class="col-md-4">
								<input name="categoria" id="categoria" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="num_camere">Numero Camere</label>
							<div class="col-md-4">
								<input name="num_camere" id="num_camere" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="num_postiletto">Numero Posti letto</label>
							<div class="col-md-4">
								<input name="num_postiletto" id="num_postiletto" type="text" class="form-control">
							</div>
						</div>
						<div class="modal-footer">
							<button id="btn-reset" type="reset" class="btn btn-default" data-dismiss="modal">Close</button>
							<button id="btn-submit" type="submit" class="btn btn-primary">Save changes</button>
						</div>
					</form>
				</div>

			</div>
		</div>
	</div>
	
	<div class="modal" id="dialog-new" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h3 class="modal-title"><span class="label label-primary">Inserimento</span></h3>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" id="form-new">
						<div class="form-group">
							<label class="col-sm-4 control-label" for="id">Id</label>
							<div class="col-md-2">
								<input name="id" id="id" type=text class="form-control uneditable-input">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="tipologia">Tipologia</label>
							<div class="col-md-4">
								<input name="tipologia" id="tipologia" type=text class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="insegna">Insegna</label>
							<div class="col-md-4">
								<input name="insegna" id="insegna" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="indirizzo">Indirizzo</label>
							<div class="col-md-4">
								<input name="indirizzo" id="indirizzo" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="categoria">Categoria</label>
							<div class="col-md-4">
								<input name="categoria" id="categoria" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="num_camere">Numero Camere</label>
							<div class="col-md-4">
								<input name="num_camere" id="num_camere" type="text" class="form-control">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-4 control-label" for="num_postiletto">Numero Posti letto</label>
							<div class="col-md-4">
								<input name="num_postiletto" id="num_postiletto" type="text" class="form-control">
							</div>
						</div>
						<div class="modal-footer">
							<button id="btn-reset" type="reset" class="btn btn-default" data-dismiss="modal">Close</button>
							<button id="btn-submit" type="submit" class="btn btn-primary">Save changes</button>
						</div>
					</form>
				</div>

			</div>
		</div>
	</div>
	
</body>
</html>